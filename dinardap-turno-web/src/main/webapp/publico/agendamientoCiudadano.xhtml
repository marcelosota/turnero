<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:b="http://bootsfaces.net/ui" xmlns:p="http://primefaces.org/ui">
<ui:composition template="/template/general.xhtml">
	<ui:define name="content">

		<!--Dialog-->
		<p:dialog id="generacionTurnoDlg" header="Generacion de turno"
			modal="true" widgetVar="generacionTurnoDlg" width="35%"
			position="top" height="auto" blockScroll="true" resizable="false">
			<h:form id="formGeneracionTurnoDlg">
				<b:panel style="width: 100%" title="Turno Generado"
					rendered="#{agendamientoCiudadanoCtrl.turnoAgendado}">
					<h:panelGrid columns="1" style="width: 100%;">
						<p:panelGrid id="turnoGenerado" columns="2">
							<f:facet name="header">
								<h:outputText value="Agendamiento de Turno" />
							</f:facet>

							<h:outputText value="Registro Mercantil:" />
							<h:outputText
								value="#{agendamientoCiudadanoCtrl.turnoGenerado.registroMercantil.nombre}" />

							<h:outputText value="Cédula:" />
							<h:outputText
								value="#{agendamientoCiudadanoCtrl.turnoGenerado.cedula}" />

							<h:outputText value="Nombre:" />
							<h:outputText
								value="#{agendamientoCiudadanoCtrl.turnoGenerado.nombre}" />

							<h:outputText value="Fecha:" />
							<h:outputText
								value="#{agendamientoCiudadanoCtrl.turnoGenerado.dia}">
								<f:convertDateTime pattern="yyyy-MM-dd" />
							</h:outputText>

							<h:outputText value="Hora aproximada:" />
							<h:outputText
								value="#{agendamientoCiudadanoCtrl.turnoGenerado.hora}" />

							<h:outputText value="Código de validación:" />
							<h:outputText style="font-size: 18pt;font-weight:900;"
								value="#{agendamientoCiudadanoCtrl.turnoGenerado.validador}" />
						</p:panelGrid>
						<b:panelGrid colSpans="12"
							style="width: 100%; margin: 4px 5px; text-align: center;">
							<p:commandButton value="Imprimir" type="button"
								icon="pi pi-print" style="display:block;margin-bottom: 20px">
								<p:printer target="turnoGenerado" />
							</p:commandButton>
						</b:panelGrid>
					</h:panelGrid>
				</b:panel>
				<b:panel style="width: 100%" title="Turno no generado"
					rendered="#{!agendamientoCiudadanoCtrl.turnoAgendado}">
					<h:panelGrid columns="1" style="width: 100%;">
						<p:panelGrid id="turnoNoGenerado" columns="1">
							<f:facet name="header">
								<h:outputText
									value="Su turno no fue generado, ya no existe disponibilidad para el horario seleccionado, por favor seleccione otro horario" />
							</f:facet>
						</p:panelGrid>
					</h:panelGrid>
				</b:panel>
			</h:form>
		</p:dialog>

		<p:dialog id="agendarTurnoDlg" header="Agendamiento de Turno"
			modal="true" widgetVar="agendarTurnoDlg" resizable="false">
			<h:form id="formAgendarTurno">
				<b:panel style="width: 100%">
					<b:panelGrid colSpans="12">
						<h:outputLabel
							value="Usted seleccionó el horario de: #{agendamientoCiudadanoCtrl.horarioDTOSelected.hora}.¿Desea agendar su Turno para este Horario?" />
					</b:panelGrid>
					<b:panelGrid colSpans="6,6"
						style="width: 100%; margin: 4px 5px; text-align: center;">
						<p:commandButton value="Agendar" style="margin-right:20px;"
							icon="fa fa-fw fa-pencil-square-o"
							action="#{agendamientoCiudadanoCtrl.agendarHorario}"
							onclick="PF('generacionTurnoDlg').show()"
							update="formRegistroCiudadano, formHorarios, formGeneracionTurnoDlg, msgMensajes">
							<p:confirm header="Confirmación"
								message="¿Está segur@ que desea agendar su cita para la hora Seleccionada?"
								icon="fa fa-fw fa-warning" />
						</p:commandButton>
						<p:commandButton value="Cancelar" style="margin-right:20px;"
							icon="fa fa-fw fa-close" onclick="agendarTurnoDlg.hide()"
							update="formRegistroCiudadano, formHorarios, formGeneracionTurnoDlg, msgMensajes">
						</p:commandButton>
						<p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
							<p:commandButton value="Si" type="button"
								styleClass="ui-confirmdialog-yes" icon="fa fa-fw fa-check" />
							<p:commandButton value="No" type="button"
								styleClass="ui-confirmdialog-no" icon="fa fa-fw fa-remove" />
						</p:confirmDialog>
					</b:panelGrid>
				</b:panel>
			</h:form>
		</p:dialog>


		<h1 class="h-wai">#{etiquetas['nombre.sistema']} -
			#{agendamientoCiudadanoCtrl.tituloPagina}</h1>
		<h:form id="formRegistroCiudadano">
			<b:panel style="width: 60%"
				title="Registro de información del Ciudadano">
				<b:panelGrid colSpans="3,9" style="width: 100%; margin: 4px 5px;">
					<p:outputLabel for="registroMercantil" value="Registro Mercantil:" />
					<p:autoComplete id="registroMercantil" dropdown="true"
						value="#{agendamientoCiudadanoCtrl.turno.registroMercantil}"
						completeMethod="#{agendamientoCiudadanoCtrl.completeNombreRegistroMercantil}"
						converter="#{registroMercantilConverter}" var="registroMercantil"
						itemLabel="#{registroMercantil.nombre}"
						itemValue="#{registroMercantil}" style="width: 90%"
						inputStyle="width: 100%" maxResults="20" required="true"
						title="#{agendamientoCiudadanoCtrl.turno.registroMercantil.nombre}" />

					<p:outputLabel for="cedula" value="Cédula:" />
					<p:inputText id="cedula"
						value="#{agendamientoCiudadanoCtrl.turno.cedula}" maxlength="10"
						style="width: 75%" required="true">
						<p:keyFilter regEx="/[\d]/" />
					</p:inputText>

					<p:outputLabel for="fecha" value="Fecha:" />
					<p:datePicker id="fecha"
						value="#{agendamientoCiudadanoCtrl.turno.dia}" locale="es"
						monthNavigator="true" pattern="yyyy-MM-dd" style="width: 100%"
						inputStyle="width: 75%" readonlyInput="true" required="true"
						mindate="#{agendamientoCiudadanoCtrl.fechaMin}" />

					<p:outputLabel for="correoElectronico" value="Correo electrónico:" />
					<p:inputText id="correoElectronico"
						value="#{agendamientoCiudadanoCtrl.turno.correoElectronico}"
						maxlength="300" style="width: 75%" required="true">
						<f:validator validatorId="emailValidator"></f:validator>
					</p:inputText>

					<p:outputLabel for="celular" value="Celular:" />
					<p:inputText id="celular"
						value="#{agendamientoCiudadanoCtrl.turno.celular}" maxlength="10"
						style="width: 75%" required="true">
						<p:keyFilter regEx="/[\d]/" />
						<f:validator validatorId="cellPhoneValidator"></f:validator>
					</p:inputText>
				</b:panelGrid>
				<b:panelGrid colSpans="12"
					style="width: 100%; margin: 4px 5px; text-align: center;">
					<p:commandButton value="Buscar disponibilidad"
						id="buscarDisponiblidadBtn" style="margin-right:20px;"
						icon="fa fa-fw fa-th"
						update="formRegistroCiudadano, formHorarios, formInformacionTurno, msgMensajes"
						action="#{agendamientoCiudadanoCtrl.buscarDisponibilidad}" />
				</b:panelGrid>
			</b:panel>
		</h:form>

		<h:form id="formHorarios">
			<b:panel style="width: 60%" title="Horarios disponibles"
				rendered="#{agendamientoCiudadanoCtrl.renderHorarios}">
				<h:panelGrid columns="1" style="width: 100%;">
					<!--<p:messages id="messagesHorarios" showDetail="true" closable="true"/>-->
					<p:dataTable id="horarioTbl"
						value="#{agendamientoCiudadanoCtrl.horarioDTOList}" var="horario"
						selection="#{agendamientoCiudadanoCtrl.horarioDTOSelected}"
						reflow="true" rows="5" paginator="true"
						paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
						rowsPerPageTemplate="5,10,25,50" tableStyle="width:auto">
						<f:facet name="header">Horarios Disponibles</f:facet>
						<p:column headerText="Hora" sortBy="#{horario.hora}" width="40%"
							style="text-align: center">
							<h:outputText value="#{horario.hora}" />
						</p:column>
						<p:column headerText="Máximo de turnos"
							sortBy="#{horario.numeroVentanillas}" width="40%"
							style="text-align: center">
							<h:outputText value="#{horario.numeroVentanillas}" />
						</p:column>
						<p:column headerText="Turnos disponibles"
							sortBy="#{horario.turnosDisponibles}" width="20%"
							style="text-align: center">
							<h:outputText value="#{horario.turnosDisponibles}" />
						</p:column>
						<p:column style="width:10%">
							<p:commandButton value="Seleccionar"
								title="Seleccionar horario #{horario.hora}" style="width: auto;"
								action="#{agendamientoCiudadanoCtrl.seleccionarHorario}"
								disabled="#{horario.turnosDisponibles eq 0? true:false}"
								onclick="PF('agendarTurnoDlg').show()"
								update="formRegistroCiudadano, formAgendarTurno">
								<!--formHorarios, formGeneracionTurnoDlg-->
								<f:setPropertyActionListener value="#{horario}"
									target="#{agendamientoCiudadanoCtrl.horarioDTOSelected}" />
							</p:commandButton>
						</p:column>
					</p:dataTable>
				</h:panelGrid>
			</b:panel>
		</h:form>

		<h:form id="formInformacionTurno">
			<b:panel style="width: 60%" title="Información del turno Agendado"
				rendered="#{agendamientoCiudadanoCtrl.renderInformacionTurno}">
				<b:panelGrid colSpans="12">
					<p:outputPanel style="text-align:center;">
						<p:panelGrid id="turnoGenerado" columns="2"
							style="text-align: center; margin: 5px auto">
							<f:facet name="header">
								<h:outputText value="Agendamiento de Turno" />
							</f:facet>

							<h:outputText value="Registro Mercantil:" />
							<h:outputText
								value="#{agendamientoCiudadanoCtrl.turno.registroMercantil.nombre}" />

							<h:outputText value="Cédula:" />
							<h:outputText value="#{agendamientoCiudadanoCtrl.turno.cedula}" />

							<h:outputText value="Nombre:" />
							<h:outputText value="#{agendamientoCiudadanoCtrl.turno.nombre}" />

							<h:outputText value="Fecha:" />
							<h:outputText value="#{agendamientoCiudadanoCtrl.turno.dia}">
								<f:convertDateTime pattern="yyyy-MM-dd" />
							</h:outputText>

							<h:outputText value="Hora aproximada:" />
							<h:outputText value="#{agendamientoCiudadanoCtrl.turno.hora}" />

							<h:outputText value="Código de validación:" rendered="false" />
							<h:outputText
								style="font-size: 18pt;font-weight:900;"
								value="#{agendamientoCiudadanoCtrl.turno.validador}"
								rendered="false" />
						</p:panelGrid>
						<b:panelGrid colSpans="6,6"
							style="width: 100%; text-align: center;">
							<p:commandButton value="Imprimir" style="margin-right:20px;"
								icon="fa fa-fw fa-print" type="button">
								<p:printer target="turnoGenerado" />
							</p:commandButton>
							<p:commandButton value="Cancelar turno"
								style="margin-right:20px;" icon="fa fa-fw fa-close"
								action="#{agendamientoCiudadanoCtrl.cancelarTurno}"
								update="formInformacionTurno" />

						</b:panelGrid>
						<b:panel style="text-align: center; margin: 5px auto"
							rendered="#{agendamientoCiudadanoCtrl.renderCancelacionTurno}">
							<b:panelGrid colSpans="3,9" style="width: 100%; margin: 4px 5px;">
								<p:outputLabel for="codigoValidacion"
									value="Código de validación:" />
								<p:inputText id="codigoValidacion"
									value="#{agendamientoCiudadanoCtrl.codigoIngresado}"
									maxlength="300" style="width: 75%" required="true">
								</p:inputText>
							</b:panelGrid>
							<b:panelGrid colSpans="12"
								style="width: 100%; margin: 4px auto; text-align: center;">
								<p:commandButton value="Confirmar anulación"
									style="margin-right:20px;" icon="fa fa-fw fa-save"
									action="#{agendamientoCiudadanoCtrl.confirmarCancelacionTurno}"
									update="formInformacionTurno, msgMensajes">
									<p:confirm header="Confirmación"
										message="¿Está segur@ que desea anular el turno asignado?"
										icon="fa fa-fw fa-warning" />
								</p:commandButton>
								<p:confirmDialog global="true" showEffect="fade"
									hideEffect="fade">
									<p:commandButton value="Si" type="button"
										styleClass="ui-confirmdialog-yes" icon="fa fa-fw fa-check" />
									<p:commandButton value="No" type="button"
										styleClass="ui-confirmdialog-no" icon="fa fa-fw fa-remove" />
								</p:confirmDialog>
							</b:panelGrid>
						</b:panel>
					</p:outputPanel>
				</b:panelGrid>
			</b:panel>
		</h:form>
	</ui:define>
</ui:composition>
</html>
