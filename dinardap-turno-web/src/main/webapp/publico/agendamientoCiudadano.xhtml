<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:p="http://primefaces.org/ui">    
    <ui:composition template="/template/general.xhtml">
        <ui:define name="content">
            <!--Dialog-->          

            <b:modal id="generacionTurnoDlg" title="Generación de turno" styleClass="modalPseudoClass">
                <h:form id="formGeneracionTurnoDlg">
                    <!--<p:scrollPanel mode="native" styleClass="scrollA">-->
                    <p:panelGrid id="turnoGenerado"
                                 rendered="#{agendamientoCiudadanoCtrl.turnoAgendado}">
                        <f:facet name="header">
                            <p:row>
                                <p:column colspan="2"><h:outputText value="Agendamiento de Turno" /></p:column>
                            </p:row>
                        </f:facet>
                        <p:row>
                            <p:column style="font-weight: bold;">Registro Mercantil:</p:column>
                            <p:column>
                                <h:outputText
                                    value="#{agendamientoCiudadanoCtrl.turnoGenerado.registroMercantil.nombre}" />
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column style="font-weight: bold;">Cédula:</p:column>
                            <p:column>
                                <h:outputText
                                    value="#{agendamientoCiudadanoCtrl.turnoGenerado.cedula}" />
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column style="font-weight: bold;">Nombre:</p:column>
                            <p:column>
                                <h:outputText
                                    value="#{agendamientoCiudadanoCtrl.turnoGenerado.nombre}" />
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column style="font-weight: bold;">Fecha:</p:column>
                            <p:column>
                                <h:outputText
                                    value="#{agendamientoCiudadanoCtrl.turnoGenerado.dia}">
                                    <f:convertDateTime pattern="yyyy-MM-dd" />
                                </h:outputText>
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column style="font-weight: bold;">Hora aproximada:</p:column>
                            <p:column>
                                <h:outputText
                                    value="#{agendamientoCiudadanoCtrl.turnoGenerado.hora}" />
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column style="font-weight: bold;">Código de validación:</p:column>
                            <p:column>
                                <h:outputText style="font-size: 16pt;font-weight:900; color:#3558A2 "
                                              value="#{agendamientoCiudadanoCtrl.turnoGenerado.validador}"/>
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column colspan="2">
                                <h:outputText value="NOTA: Turno válido únicamente para un trámite."
                                              style="font-size: 16pt;font-weight:900;" />                                
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column colspan="2">
                                <h:outputText value="#{etiquetas['mensaje.informativo']}"
                                              style="font-size: 16pt;font-weight:900; color: #EC6508" />
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column colspan="2">
                                <p:commandButton value="Imprimir" type="button"
                                                 icon="fa fa-fw fa-print" style="display:block; margin:auto">
                                    <p:printer target="turnoGenerado" />
                                </p:commandButton>
                            </p:column>
                        </p:row>
                    </p:panelGrid>
                    <p:panelGrid id="turnoNoGenerado" columns="1" rendered="#{!agendamientoCiudadanoCtrl.turnoAgendado}">
                        <f:facet name="header">
                            <h:outputText
                                value="Su turno no fue generado, ya no existe disponibilidad para el horario seleccionado, por favor seleccione otro horario" />
                        </f:facet>
                    </p:panelGrid>
                    <!--</p:scrollPanel>-->
                </h:form>

            </b:modal>

            <p:dialog id="agendarTurnoDlg" header="Agendamiento de Turno"
                      modal="true" widgetVar="agendarTurnoDlg" resizable="false">
                <h:form id="formAgendarTurno">
                    <b:panel style="width: 100%">
                        <b:panelGrid colSpans="12">
                        	<h:outputLabel value="#{etiquetas['recordatorio.turno']}"/>
                            <h:outputLabel
                                value="Usted seleccionó el horario de: #{agendamientoCiudadanoCtrl.horarioDTOSelected.hora}.¿Desea agendar su Turno para este Horario?" />
                        </b:panelGrid>
                        <b:panelGrid colSpans="6,6"
                                     style="width: 100%; text-align: center;">
                            <p:commandButton value="Agendar" 
                                             style="margin:2px;"
                                             icon="fa fa-fw fa-pencil-square-o"
                                             action="#{agendamientoCiudadanoCtrl.agendarHorario}"
                                             onclick="$('.modalPseudoClass').modal()"
                                             update="formRegistroCiudadano, formHorarios, formGeneracionTurnoDlg, msgMensajes">
                                <p:confirm header="Confirmación"
                                           message="¿Está segur@ que desea agendar su cita para la hora Seleccionada?"
                                           icon="fa fa-fw fa-warning" />
                            </p:commandButton>
                            <p:commandButton value="Cancelar" style="margin:2px;"
                                             icon="fa fa-fw fa-close" onclick="agendarTurnoDlg.hide()"
                                             update="formRegistroCiudadano, formHorarios, formGeneracionTurnoDlg, msgMensajes">
                            </p:commandButton>
                            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                                <p:commandButton value="Si" type="button"
                                                 styleClass="ui-confirmdialog-yes" icon="fa fa-fw fa-check" />
                                <p:commandButton value="No" type="button"
                                                 styleClass="ui-confirmdialog-no" icon="fa fa-fw fa-remove" />
                            </p:confirmDialog>
                        </b:panelGrid>
                    </b:panel>
                </h:form>
            </p:dialog>


            <h1 class="h-wai">#{etiquetas['nombre.sistema']} -
                #{agendamientoCiudadanoCtrl.tituloPagina}</h1>
            <h:form id="formRegistroCiudadano">
                <b:panel styleClass="panelA"
                         title="Registro de información del Ciudadano">
                    <p:panelGrid columns="2" layout="grid" columnClasses="form-label-izquierda ui-g-12 ui-md-3 ui-lg-2, form-input-izquierda ui-g-12 ui-md-9 ui-lg-10" >

                        <p:outputLabel for="registroMercantil" value="Registro Mercantil:" />
                        <p:autoComplete id="registroMercantil" dropdown="true"
                                        value="#{agendamientoCiudadanoCtrl.turno.registroMercantil}"
                                        completeMethod="#{agendamientoCiudadanoCtrl.completeNombreRegistroMercantil}"
                                        converter="#{registroMercantilConverter}" var="registroMercantil"
                                        itemLabel="#{registroMercantil.nombre}"
                                        itemValue="#{registroMercantil}" style="width: 100%"
                                        inputStyle="width: 100%" maxResults="20" required="true"
                                        title="#{agendamientoCiudadanoCtrl.turno.registroMercantil.nombre}" />

                        <p:outputLabel for="cedula" value="Cédula:" />
                        <p:inputText id="cedula"
                                     value="#{agendamientoCiudadanoCtrl.turno.cedula}" maxlength="10"
                                     style="width:100%" required="true">
                            <p:keyFilter regEx="/[\d]/" />
                        </p:inputText>

                        <p:outputLabel for="fecha" value="Fecha:" />                       
                        <p:calendar id="fecha"
                                    value="#{agendamientoCiudadanoCtrl.turno.dia}"
                                    required="true"	
                                    requiredMessage="Fecha-#{mensajes['requerido']}"
                                    pattern="yyyy-MM-dd"
                                    readonlyInput="true" 
                                    mindate="#{agendamientoCiudadanoCtrl.fechaMin}"
                                    style="width: 100%"
                                    inputStyle="width: 100%" 
                                    locale="es" />

                        <p:outputLabel for="correoElectronico" value="Correo electrónico:" />
                        <p:inputText id="correoElectronico"
                                     value="#{agendamientoCiudadanoCtrl.turno.correoElectronico}"
                                     maxlength="300" style="width: 100%" required="true">
                            <f:validator validatorId="emailValidator"></f:validator>
                        </p:inputText>

                        <p:outputLabel for="celular" value="Celular:" />
                        <p:inputText id="celular"
                                     value="#{agendamientoCiudadanoCtrl.turno.celular}" maxlength="10"
                                     style="width: 100%" required="true">
                            <p:keyFilter regEx="/[\d]/" />
                            <f:validator validatorId="cellPhoneValidator"></f:validator>
                        </p:inputText>

                    </p:panelGrid>
                    <h:panelGrid columns="1" style="text-align: center; width: 100%;margin: 5px 0;">
                        <p:commandButton value="Buscar Disponibilidad"
                                         id="buscarDisponiblidadBtn"
                                         icon="fa fa-fw fa-th"
                                         update="formHorarios, formInformacionTurno, msgMensajes"
                                         action="#{agendamientoCiudadanoCtrl.buscarDisponibilidad}" />
                    </h:panelGrid>
                </b:panel>
            </h:form>

            <h:form id="formHorarios">
                <b:panel styleClass="panelA" title="Horarios disponibles"
                         rendered="#{agendamientoCiudadanoCtrl.renderHorarios}">
                    <h:panelGrid columns="1" style="width: 100%;">
                        <p:dataTable id="horarioTbl"
                                     value="#{agendamientoCiudadanoCtrl.horarioDTOList}" var="horario"
                                     selection="#{agendamientoCiudadanoCtrl.horarioDTOSelected}"
                                     reflow="true" rows="5" paginator="true"
                                     paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     rowsPerPageTemplate="5,10,25,50" tableStyle="width:100%">
                            <f:facet name="header">#{etiquetas['nota.turno.unico']}</f:facet>
                            <p:column headerText="Hora" sortBy="#{horario.hora}" width="30%"
                                      style="text-align: center">
                                <h:outputText value="#{horario.hora}" />
                            </p:column>
                            <p:column headerText="Máximo de turnos"
                                      sortBy="#{horario.numeroVentanillas}" width="30%"
                                      style="text-align: center">
                                <h:outputText value="#{horario.numeroVentanillas}" />
                            </p:column>
                            <p:column headerText="Turnos disponibles"                                      
                                      sortBy="#{horario.turnosDisponibles}" width="20%"
                                      style="text-align: center">
                                <h:outputText value="#{horario.turnosDisponibles}" />
                            </p:column>
                            <p:column headerText="Acción"
                                      width="20%"
                                      style="text-align: center">
                                <p:commandButton value="Seleccionar"
                                                 title="Seleccionar horario #{horario.hora}" style="width: auto;"
                                                 action="#{agendamientoCiudadanoCtrl.seleccionarHorario}"
                                                 disabled="#{horario.turnosDisponibles eq 0? true:false}"
                                                 onclick="PF('agendarTurnoDlg').show()"
                                                 update="formRegistroCiudadano, formAgendarTurno">
                                    <!--formHorarios, formGeneracionTurnoDlg-->
                                    <f:setPropertyActionListener value="#{horario}"
                                                                 target="#{agendamientoCiudadanoCtrl.horarioDTOSelected}" />
                                </p:commandButton>
                            </p:column>
                        </p:dataTable>
                    </h:panelGrid>
                </b:panel>
            </h:form>

            <h:form id="formInformacionTurno">
                <b:panel styleClass="panelA" title="Información del turno Agendado"
                         rendered="#{agendamientoCiudadanoCtrl.renderInformacionTurno}">
                    <b:panelGrid colSpans="12">
                        <p:outputPanel style="text-align:center;">
                            <!--<p:panelGrid columns="2" layout="grid" columnClasses="ui-g-12 ui-md-3 ui-lg-2, ui-g-12 ui-md-9 ui-lg-10" >-->
                            <p:panelGrid id="turnoGenerado" columns="2"
                                         style="text-align: center; margin: 5px auto">
                                <f:facet name="header">
                                    <h:outputText value="Agendamiento de Turno" />
                                </f:facet>

                                <h:outputText value="Registro Mercantil:" />
                                <h:outputText
                                    value="#{agendamientoCiudadanoCtrl.turno.registroMercantil.nombre}" />

                                <h:outputText value="Cédula:" />
                                <h:outputText value="#{agendamientoCiudadanoCtrl.turno.cedula}" />

                                <h:outputText value="Nombre:" />
                                <h:outputText value="#{agendamientoCiudadanoCtrl.turno.nombre}" />

                                <h:outputText value="Fecha:" />
                                <h:outputText value="#{agendamientoCiudadanoCtrl.turno.dia}">
                                    <f:convertDateTime pattern="yyyy-MM-dd" />
                                </h:outputText>

                                <h:outputText value="Hora aproximada:" />
                                <h:outputText value="#{agendamientoCiudadanoCtrl.turno.hora}" />

                                <h:outputText value="Código de validación:" rendered="false" />
                                <h:outputText
                                    style="font-size: 18pt;font-weight:900;"
                                    value="#{agendamientoCiudadanoCtrl.turno.validador}"
                                    rendered="false" />
                            </p:panelGrid>

                            <h:panelGrid columns="2" style="text-align: center; width: 100%;" columnClasses="ui-g-12 ui-md-6 ui-lg-6,ui-g-12 ui-md-6 ui-lg-6">
                                <p:commandButton value="Obtener Código" 
                                                 icon="fa fa-fw fa-envelope" 
                                                 action="#{agendamientoCiudadanoCtrl.remitirTurno}"
                                                 process="@this"
                                                 update="formInformacionTurno, 
                                                 formInformacionTurno:cancelarTurno, 
                                                 formInformacionTurno:remitirCodigo"/>
                                <p:commandButton value="Cancelar Turno" 
                                                 icon="fa fa-fw fa-close"
                                                 process="@this"
                                                 action="#{agendamientoCiudadanoCtrl.cancelarTurno}"
                                                 update="formInformacionTurno, 
                                                 formInformacionTurno:cancelarTurno, 
                                                 formInformacionTurno:remitirCodigo"/>
                            </h:panelGrid>


                            <b:panel id="cancelarTurno"
                                     style="text-align: center;"
                                     rendered="#{agendamientoCiudadanoCtrl.renderCancelacionTurno}">
                                <p:panelGrid columns="2" layout="grid" columnClasses="form-label-izquierda ui-g-12 ui-md-3 ui-lg-2, form-input-izquierda ui-g-12 ui-md-9 ui-lg-10" >
                                    <p:outputLabel for="codigoValidacion"
                                                   value="Código de validación:" />
                                    <p:inputText id="codigoValidacion"
                                                 value="#{agendamientoCiudadanoCtrl.codigoIngresado}"
                                                 maxlength="300" style="width: 100%" required="true">
                                    </p:inputText>
                                </p:panelGrid>

                                <h:panelGrid columns="1" style="text-align: center; width: 100%; margin: 5px 0;">
                                    <p:commandButton value="Confirmar anulación"
                                                     icon="fa fa-fw fa-save"
                                                     action="#{agendamientoCiudadanoCtrl.confirmarCancelacionTurno}"                                                         
                                                     update="formInformacionTurno, msgMensajes">
                                        <p:confirm header="Confirmación"
                                                   message="¿Está segur@ que desea anular el turno asignado?"
                                                   icon="fa fa-fw fa-warning" />
                                    </p:commandButton>
                                    <p:confirmDialog global="true" showEffect="fade"
                                                     hideEffect="fade">
                                        <p:commandButton value="Si" type="button"
                                                         styleClass="ui-confirmdialog-yes" icon="fa fa-fw fa-check" />
                                        <p:commandButton value="No" type="button"
                                                         styleClass="ui-confirmdialog-no" icon="fa fa-fw fa-remove" />
                                    </p:confirmDialog>
                                </h:panelGrid>
                            </b:panel>

                            <b:panel id="remitirCodigo"
                                     style="text-align: center;"
                                     rendered="#{agendamientoCiudadanoCtrl.renderRemitirTurno}">
                                <p:panelGrid columns="2" layout="grid" columnClasses="form-label-izquierda ui-g-12 ui-md-3 ui-lg-2, form-input-izquierda ui-g-12 ui-md-9 ui-lg-10" >
                                    <p:outputLabel for="correoAgendado"
                                                   value="Correo electrónico:" />
                                    <p:inputText id="correoAgendado"
                                                 value="#{agendamientoCiudadanoCtrl.correoIngresado}"
                                                 maxlength="300" style="width: 100%" required="true">
                                    </p:inputText>
                                </p:panelGrid>

                                <h:panelGrid columns="1" style="text-align: center; width: 100%; margin: 5px 0;">
                                    <p:commandButton value="Envío de Código"
                                                     icon="fa fa-fw fa-mail-forward"
                                                     action="#{agendamientoCiudadanoCtrl.confirmarRemitirTurno}"
                                                     update="formInformacionTurno, msgMensajes">
                                        <p:confirm header="Confirmación"
                                                   message="¿Desea recuperar el código Asignado?"
                                                   icon="fa fa-fw fa-warning" />
                                    </p:commandButton>
                                    <p:confirmDialog global="true" showEffect="fade"
                                                     hideEffect="fade">
                                        <p:commandButton value="Si" type="button"
                                                         styleClass="ui-confirmdialog-yes" icon="fa fa-fw fa-check" />
                                        <p:commandButton value="No" type="button"
                                                         styleClass="ui-confirmdialog-no" icon="fa fa-fw fa-remove" />
                                    </p:confirmDialog>
                                </h:panelGrid>
                            </b:panel>



                        </p:outputPanel>
                    </b:panelGrid>
                </b:panel>
            </h:form>
        </ui:define>
    </ui:composition>
</html>