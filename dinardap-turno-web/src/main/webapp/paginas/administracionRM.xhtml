<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:b="http://bootsfaces.net/ui" xmlns:p="http://primefaces.org/ui">

    <!-- 
                    Replace path to template, title, header and body
                    with actual data.
    -->
    <ui:composition template="/template/general.xhtml">
        <ui:define name="content">
            <h1 class="h-wai">#{etiquetas['nombre.sistema']} - Administración Turnos Registro Mercantil
                Registro mercantil</h1>

            <p:dialog id="informacionTurnoDlg"
                      widgetVar="informacionTurnoDlg"
                      header="Información de Turnos"
                      modal="true"  
                      resizable="false"
                      style="text-align:center">
                <h:form id="formInformacionTurnoDlg">
                    <!--<p:scrollPanel mode="native" styleClass="scrollA">-->
                    <p:panelGrid style="width: 100%">
                        <f:facet name="header">
                            <p:row>
                                <p:column colspan="2"><h:outputText value="Información de Turnos" /></p:column>
                            </p:row>
                        </f:facet>                        
                        <p:row>
                            <p:column style="font-weight: bold;">Cédula:</p:column>
                            <p:column>
                                <h:outputText
                                    value="#{administracionRMCtrl.turno.cedula}" />
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column style="font-weight: bold;">Nombre:</p:column>
                            <p:column>
                                <h:outputText
                                    value="#{administracionRMCtrl.turno.nombre}" />
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column style="font-weight: bold;">Fecha:</p:column>
                            <p:column>
                                <h:outputText
                                    value="#{administracionRMCtrl.turno.dia}">
                                    <f:convertDateTime pattern="yyyy-MM-dd" />
                                </h:outputText>
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column style="font-weight: bold;">Hora:</p:column>
                            <p:column>
                                <h:outputText
                                    value="#{administracionRMCtrl.turno.hora}" />
                            </p:column>
                        </p:row>
                    </p:panelGrid>
                    <p:panelGrid id="turnoNoGenerado" columns="2" style="text-align: center; width: 100%">
                        <f:facet name="header">
                            <p:row>
                                <p:column colspan="2"><h:outputText value="¿Desea atender el Turno Seleccionado?" /></p:column>
                            </p:row>
                        </f:facet>                        
                        <p:commandButton value="Atender" action="#{administracionRMCtrl.ciudadanoAtendido}" update="msgMensajes formInicio:dtbRegistros formInicio:dtbCiudadanos informacionTurnoDlg"/>
                        <p:commandButton value="Cancelar" oncomplete="PF('informacionTurnoDlg').hide();"/>
                    </p:panelGrid>
                    <!--</p:scrollPanel>-->
                </h:form>

            </p:dialog>


            <h:form id="formInicio">
                <p:remoteCommand name="actualizarTabla"
                                 action="#{administracionRMCtrl.consultar}" />
                <h:panelGrid columns="2"
                             columnClasses="form-label-derecha ui-grid-col-1, form-input-izquierda">
                    <h:outputLabel value="#{etiquetas['registro.mercantil']}" />
                    <b:selectOneMenu id="cmbRegistros" update="@this dtbRegistros"
                                     disabled="true"
                                     process="@this" value="#{administracionRMCtrl.registroMercantilId}"
                                     required="true"
                                     required-message="#{etiquetas['registro.mercantil']}#{mensajes['requerido']}"
                                     styleClass="form-combo-centrado"
                                     onchange="ajax:administracionRMCtrl.limpiar()">
                        <f:selectItem itemLabel="-- Seleccione un Registro --"
                                      itemValue="0" />
                        <f:selectItems value="#{administracionRMCtrl.registroMercantil}"
                                       var="registros" itemLabel="#{registros.nombre}"
                                       itemValue="#{registros.registroMercantilId}" />
                    </b:selectOneMenu>
                    <p:outputLabel for="calendario" value="#{etiquetas['fecha']}" />
                    <p:calendar id="calendario" value="#{administracionRMCtrl.fecha}"
                                required="true"					
                                requiredMessage="Fecha-#{mensajes['requerido']}"
                                pattern="yyyy-MM-dd" mindate="#{administracionRMCtrl.fechaInicio}"
                                maxdate="#{administracionRMCtrl.fechaFin}" />
                </h:panelGrid>
                <br />
                <p:commandButton value="#{etiquetas['buscar']}" update="msgMensajes dtbRegistros"
                                 actionListener="#{administracionRMCtrl.consultar()}"
                                 icon="ui-icon-search" process="@this, cmbRegistros, calendario" />
                <br />
                <br />

                <p:panelGrid columns="2" layout="grid" columnClasses="ui-g-12 ui-md-6 ui-lg-6,ui-g-12 ui-md-6 ui-lg-6" >
                    <p:dataTable id="dtbRegistros"
                                 value="#{administracionRMCtrl.reporteTurnos}" 
                                 rowKey="#{dtb.hora}"
                                 var="dtb"
                                 paginator="true" 
                                 rows="10"
                                 emptyMessage="No existen registros"
                                 selectionMode="single"
                                 selection="#{administracionRMCtrl.horaSeleccionada}">

                        <p:ajax event="rowSelect" listener="#{administracionRMCtrl.onRowSelectHora}" update="formInicio:dtbCiudadanos"/>

                        <p:column headerText="#{etiquetas['hora']}" width="20%">
                            <h:outputText value="#{dtb.hora}" styleClass="texto-justificado">
                            </h:outputText>
                        </p:column>
                        <p:column headerText="#{etiquetas['agendado']}" width="20%">
                            <h:outputText value="#{dtb.agendada}"
                                          styleClass="texto-justificado" />
                        </p:column>
                        <p:column headerText="#{etiquetas['atendido']}" width="20%">
                            <h:outputText value="#{dtb.atendido}"
                                          styleClass="texto-justificado" />
                        </p:column>
                        <p:column headerText="#{etiquetas['por.atender']}" width="20%">
                            <h:outputText value="#{dtb.pendiente}"
                                          styleClass="texto-justificado" />
                        </p:column>
                    </p:dataTable>
                    <p:dataTable id="dtbCiudadanos"                                 
                                 value="#{administracionRMCtrl.turnoList}"
                                 var="turno"
                                 rowKey="#{turno.turnoId}"
                                 paginator="true"
                                 rows="10"
                                 emptyMessage="No existen registros">                        
                        <p:column headerText="#{etiquetas['cedula']}" width="33%">
                            <h:outputText value="#{turno.cedula}" styleClass="texto-justificado">
                            </h:outputText>
                        </p:column>
                        <p:column headerText="#{etiquetas['nombreCiudadanoTurno']}" width="33%">
                            <h:outputText value="#{turno.nombre}" styleClass="texto-justificado">
                            </h:outputText>
                        </p:column>
                        <p:column headerText="#{etiquetas['estadoTurno']}" width="33%">
                            <h:outputText value="#{turno.estado eq 1? 'Agendado':'Atendido'}" 
                                          styleClass="texto-justificado">
                            </h:outputText>
                        </p:column>                        
                    </p:dataTable>
                </p:panelGrid>
                <p:separator />
                <br />
                <p:panel id="basic"
                         header="#{etiquetas['registrar.atencion.ciudadano']}"
                         style="margin-bottom:20px">
                    <h:panelGrid columns="3" width="30%" cellpadding="10"
                                 columnClasses="form-label3, form-input-ajustado, form-input-ajustado">
                        <h:outputLabel value="#{etiquetas['turno']}*" />
                        <p:inputText id="txtTurno"
                                     value="#{administracionRMCtrl.validador}" maxlength="20"
                                     required="true"
                                     requiredMessage="Turno-#{mensajes['requerido']}" />
                        <p:commandButton id="btnAtendido" value="#{etiquetas['atendido']}"
                                         icon="ui-icon-document" style="FONT-WEIGHT: bold;"
                                         update="msgMensajes dtbRegistros formInicio:dtbCiudadanos informacionTurnoDlg" process="@this txtTurno"
                                         action="#{administracionRMCtrl.atenderTurno}"> 
                        </p:commandButton>
                        <p:tooltip for="btnAtendido" value="#{mensajes['atendido']}" />
                    </h:panelGrid>
                </p:panel>
            </h:form>
        </ui:define>
    </ui:composition>
</html>